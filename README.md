# autopush
Данный скрипт синхронизирует два репозитория на гитхабе со сменой автора коммитов

Суть работы скрипта:

Каждые 10 секунд скрипт сравнивает последний локально зафиксированный коммит определнной ветки репозитория с коммитом, зафиксированном в той же ветке
в удаленном репозитории и в случае их несоответствия синхронизирует два репозитория, меняя автора коммита

## Установка

```
git clone https://github.com/buldozzzer/autopush
```

## Запуск

Для работы скрипта требуется склонировать целевые репозитории на хост, на котором будет запущен скрипт,
затем в каждом репозитории требуется добавить путь к удаленному репозиторию:

```
git remote add origin <ssh-путь/к/репозиторию>
```
Для обновления репозиториев я использую SSH-ключи ( https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account ),
соответственно, для вашего аккаунта-посредника он тоже должен быть настроен на хосте, где запущен скрипт

### Конфигурационный файл

Конфигурационный файл - config


- **target_branch** - целевая ветка
- **path_to_dev_repo** - путь к локальному репозиторию разработки
- **path_to_prod_repo** - путь к локальному репозиторию продакшена
- **dev_repo_name** - имя автора коммита в репозитории разработки, которое требуется изменить
- **dev_repo_email** - email автора коммита в репозитории разработки, который требуется изменить
- **prod_repo_name** - имя автора коммита в репозитории продакшена, которое требуется изменить
- **prod_repo_email** - email автора коммита в репозитории продакшена, который требуется изменить
- **new_name** - имя автора коммита (посредника)
- **new_email** - email автора коммита (посредника)
- **original_remote_repo** - имя наблюдаемого удаленного репозитория, данное командой ```git remote add```
- **new_remote_repo** - имя удаленного репозитория, который требуется синхронизировать  (произвольное, если предварительно не назначено)

### На хосте
```
cd autopush
python3 -m venv venv && source venv/bin/activate
pip install -r requirements.txt
```
Непосредственно сам запуск (в диретории со скриптом):
```
python3 main.py
```
### Docker

В диретории со скриптом:
```
docker build -t autopush .
```
```
docker run -d -v /путь/к/репозторию/1/на/хосте:/путь/к/репозторию/1/в/контейнере \
-v /путь/к/репозторию/2/на/хосте:/путь/к/репозторию/2/в/контейнере \
-v /путь/к/конфигурационному/файлу/на/хосте/config:/путь/к/конфигурационному/файлу/в/контейнере/config \
--net=host autopush
```
